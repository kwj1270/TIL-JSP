필수 이해 요소
=======================
# 1. JSP 처리 과정
간단한 개요로 웹 서버가 웹 브라우저와 동작하기 위해서 **서블릿** 이 존재해야 한다.  
  
우선 톰캣서버의 JSP 처리 과정을 알아보자  
![JSP 처리 과정](https://user-images.githubusercontent.com/50267433/63404231-5626f480-c41d-11e9-8ffe-0d18b140cb86.jpg)
WAS(톰캣)는 JSP 페이지에 대한 요청이 들어오면 위 그림과 같이 처리를 한다.  
  
* JSP에 해당하는 서블릿이 존재하지 않을 경우. (과정1.1)  
  -JSP 페이지로부터 자바 코드를 생성한다. (과정1.2)  
  -자바 코드를 컴파일해서 서블릿 클래스를 생성한다. (과정1.3)  
  -서블릿에 클라이언트 요청을 전달한다. (과정2.1)  
  -서블릿이 요청을 처리한 결과를 응답으로 생성한다. (과정2.2)  
  -응답을 웹 브라우저에 전송한다. (과정3)   
* JSP에 해당하는 서블릿이 존재하는 경우(즉,이미 1.1~1.3 을 거친 경우)  
  -서블릿에 클라이언트 요청을 전달한다. (과정2.1)   
  -서블릿이 요청을 처리한 결과를 응답으로 생성한다. (과정2.2)      
  -응답을 웹 브라우저에 전송한다. (과정3)     
             
즉, JSP 페이지를 요청할 때에는 JSP를 직접 실행한는 것이 아니라,       
JSP를 자바 소스코드로 변환한 뒤 컴파일해서 생성한 서블릿을 실행하는 것이다.       
여기서 JSP 페이지를 자바 코드로 변경하는 단계를 **변환 단계 (translation)**  
자바 코드를 서블릿 클래스로 변경하는 단계를 **컴파일 단계**라고 한다.       
  
***
# 2. 출력 버퍼의 응답
JSP 페이지는 응답 결과를 곧바로 웹 브라우저에 전송하지 않는다.  
대신 출력 버퍼라고 불리는 곳에 임시로 응답 결과를 저장했다가 한 번에 웹 브라우저에 전송한다.
   
* 데이터 전송 성능 향상  
* JSP 실행 도중에 버퍼를 비우고 새로운 내용 전송 가능  
* 버퍼가 다 차기 전까지 헤더 변경 가능   
    
**데이터 전송 성능 향상**은 작은 데이터를 여러번 주고 받기보다 한번에 많은 양의 데이터를 사용함으로써 성능을 향상시킨다.      
**JSP 실행 도중에 버퍼를 비우고 새로운 내용 전송 가능** 과 **버퍼가 다 차기 전까지 헤더 변경 가능**은  
데이터가 일단 버퍼에 저장되는것이니 이를 즉시처리 또는 변경을 할 수 있는 기회가 생기기에 이러한 장점이 있는 것이다.     
또한 헤더와 같은 경우는 ```HTTP 프로토콜```의 구조상 응답 상태 코드와 함께 우선적으로 웹 브라우저에 전송하기에    
이러한 헤더 변경은 버퍼의 가장 좋은 장점 중 하나로 꼽을 수 잇다.            
  
## 2.1. page 디렉티브에서 버퍼 설정하기 : buffer 속성과 autoFlush 속성
### 2.1.1. buffer 속성

page 디렉티브(```<% @page %> ```)는 ```buffer 속성```을 제공하고 있다.    
```buffer 속성```을 사용하면 JSP 페이지가 사용할 버퍼를 설정할 수 있다.    
  
**예시** 
```
<% @page buffer="4KB"%>
```
그리고 일반적으로 ```buffer 속성```을 지정하지 않는다.       
왜냐하면 기본적으로 ```8KB```의 버퍼를 지원하도록 규정이 되어있기 때문이다.      
    
**버퍼 해제**
```
<% @page buffer="none" %>
```
```buffer 속성```의 값을 ```none```으로 지정하는 경우는 거의 없지만 이렇게 버퍼를 해제할 수 있다.      
다만 이렇게 사용할 경우 JSP 페이지가 출력하는 내용을 곧바로 전송하기 때문에 몇가지 기능에 제한이 따른다.
  
* <jsp:forward>기능을 사용할 수 없다.    
* 곧바로 전송되기 때문에 출력한 내용을 취소할 수 없다.           
  
### 2.1.2. autoFlush 속성
버퍼가 다 차면 JSP 페이지는 버퍼의 내용을 웹 브라우저에 전송한 후 버퍼를 비우고 새롭게 버퍼에 내용을 채우기 시작한다.           
이 때 버퍼에 보관된 응답 데이터를 전송하기 전에 응답 상태 코드와 응답 헤더를 먼저 전송한다.         
(따라서 이후에는 응답 헤더 값을 변경해도 웹 브라우저에 전송되지 않고 무시된다.)    
이러한 작업을 ```flush```라고 하며 page 디렉티브에서는 이러한 동작을 설정하는 ```autoFlush 속성```이 존재한다.      
     
```autoFlush 속성``` 은 ```true```나 ```false```를 값으로 갖는데, 각 값에 따라서 다음과 같이 처리한다.    
    
* autoFlush="true"  : 버퍼가 다 차면 버퍼를 플러시하고 계속 작업을 진행한다.       
* autoFlush="false" : 버퍼가 다 차면 익셉션을 발생시키고 작업을 중지한다.      
     
```true```는 기본값으로 우리가 별다른 설정없이 사용하는 속성값이다.   
이로인해 버퍼가 다 차면 버퍼를 비우고 새롭게 다시 채우므로 매끄러운 동작을 취할 수 있다.     
    
```false```는 이와 반대로 수동적으로 처리함을 의미하기 때문에    
버퍼가 차면 에러를 발생시켜서 수동적으로 처리해주어야 함을 알린다.    
  
***
# 3. 웹 어플리케이션 폴더 구성과 URL 매핑
JSP를 이용해서 웹 어플리케이션을 개발하려면 기초 문법뿐만 아니라 웹 어플리케이션의 폴더 구조에 대해서도 알아야 한다.    
서블릿/JSP 규약은 웹 어플리케이션이 특정 폴더 구조를 따르도록 제한하고 있기 때문이다.     

* WEB-INF : 웹 어플리케이션 설정 저보를 담고 있는 web.xml 파일이 위치한다.  
* WEB-INF\classes : 웹 어플리케이션에서 사용하는 클래스 파일이 위치한다.  
* WEB-INF\lib : 웹 어플리케이션에서 사용하는 jar 파일이 위치한다.  

## 3.1. 웹 어플리케이션 폴더와 URL의 관계
웹 어플리케이션은 이러한 JSP로 작성한 연관된 웹 페이지들의 모음을 의미하며 이들을 하나의 폴더에 저장시킨다.  
톰캣에서 웹 어플리케이션은 ```[톰캣]\webapps``` 폴더에 위치한다.  
즉, ```localhost:8080/chap03```은 ```[톰캣]\webapps\chap03```을 의미하는 것이다.  
  
* ```[톰캣]\webapps\[웹경로]```  --->  ```http://host:port[/웹경로]```

그리고 여기서 말하는 [웹경로]를 **컨텍스트 경로**라고 한다.  
  
톰캣의 ```webapps``` 폴더에는 ```ROOT```라는 특수 폴더가 존재하고 이 폴더는 루트 웹 어플리케이션을 위한 특수폴더이다.     
URL의 첫 번째 경로와 일치하는 컨텍스트 경로를 가진 웹 어플리케이션이 존재하지 않으면,      
루트 웹 어플리케이션이 요청을 처리한다.       
    
**예를 들어**  
``` 
http://localhost:8080/view/loginForm.jsp 라는 URL을 입력했다고 가정시
/view 컨택스트 경로로 갖는 웹 어플리케이션이 존재하지 않으면, 즉 webapps\view 폴더가 존재하지 않으면, 
루트 웹 어플리케이션 폴더인 ROOT를 기준으로 /view/loginForm.jsp 파일을 찾는다.

즉 webapps\ROOT\view\loginForm.jsp 파일을 찾아 실행한다.  
```
하지만 이렇게 사용할 경우 기존에는 컨택스트 경로가 존재하지 않는다고 했으니    
컨택스트 경로를 구하고자 한다면 ```""``` 빈 문자열이 반환된다.     
```
request.getContextPath();
```
참고로 컨택스트 경로를 구하는 방법은 ```request.getContextPath()```이다.   

## 3.2. 웹 어플리케이션 폴더 내에서의 하위 폴더 사용
웹 어플리케이션내의 모든 JSP 페이지가 한 폴더에 위치하면 관리하기가 힘들어진다.   
소규모 온라인 쇼핑몰을 만드는 경우에도 수십에서 수백 개의 JSP 파일을 개발하기에 이러한 문제점을 해결해야한다.   
하지만 이러한 문제점을 해결하는 것은 쉽다. 바로 특정 주제를 가지고 파일로 나누어서 관리하면 된다. (기능별로)    
  
웹 어플리케이션을 구현할 때에는 하위 폴더를 적극적으로 사용하는 것이 개발 과정이나 유지보수에 이롭다.
  
***
# 4. 웹 어플리케이션 배포
웹 어플리케이션을 배포하는 방법에는 두가지가 있다. 
  
* 대상 폴더에 파일을 직접 복사
* war 파일로 묶어서 배포
  
파일을 직접 복사하는 방법은 간단하다. 톰캣 서버의 특정 폴더에 해당 파일을 저장하거나 붙여 넣으면 된다.    
이는 톰캣 서버의 특정 폴더에 파일을 직접 저장하는 방식을 사용하는 것이다.   
로컬 PC가 아닌 다른 컴퓨터의 폴더에 복사할 경우 FTP와 같은 파일 전송 기능을 이용해서 배포한다.  

## 4.1. 톰캣에 war 파일 배포하기  
```war```는 ```Web Application Archive```의 약자로 웹 어플리케이션의 구성요소를 하나로 묶어 놓은 파일이다.       
```war```파일로 묶으려면 ```JDK의 jar 명령어```를 사용하면 된다.      
     
**예시**        
```
C:\apache-tomcat-8.0.21\webapps\chap04> jar cvf chap04.war *
                                  
c : 새로운 파일을 생성함
v : 세부 정보를 콘솔에 표시함
f : 생성할 파일의 이름을 지정함

그리고 옵션뒤의 이름("chap04.war"을 의미)은 생성할 파일 이름 
* 은 현재 폴더(디렉토리)의 모든 파일과 하위 폴더가 대상임을 의미 즉, 전체를 의미
```   
이렇게 생성된 ```war 파일```을 실 서버의 ```[톰캣]\webapps 폴더```에 복사해주면 배포된다.    
실서버라는 것은 기존에 우리가 하는 것은 테스트를 하기 위한것이고 테스트가 완료 되었으니    
이를 ```war 파일```로 만들어서 실서버에 복사하는 것이다.    
그리고 이는 실 서버에 복사가 되엇으니 '배포'가 되었다가 말할 수 있는 것이다.      
   
참고로 웹로직과 같은 상용 소프트웨어는 웹 어플리케이션을 배포하고 관리할 수 있는 웹 기반 콘솔 프로그램을 제공한다.  
