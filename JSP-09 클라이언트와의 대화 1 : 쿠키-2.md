클라이언트와의 대화 1 : 쿠키-2
=======================
# 2. 쿠키 처리를 위한 유틸리티 클래스  
유틸리티 클래스는 개발자가 직접 정의하여서 특정 쿠키의 값을 불러오거나, 쿠키를 생성하거나 등등      
쿠키를 제어 또는 관리하는 코드들을 메소드로 만들어 클래스로 관리하는 것이다.

**유틸리티 클래스**
```
// chap09\WEB-INF\src\util\Cookies.java) <- 이 위치에 저장할 것

pakage util;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.Cookie;
import java.util.Map;
import java.net.URLEncoder;
import java.net.URLDecoder;
import java.io.IOException;

public class Cookies{
  
  pivate Map<String, Cookie> cookieMap =
    new java.util.HashMap<String, Cookie>();                  // 해쉬 맵 형태의 쿠키를 저장하는 맵 정의
    
  public Cookies(HttpServletRequest request){                 // request 객체가 인자로 들어올 것이다.
    Cookie[] cookies = request.getCookies();                  // 인자로 들어온 request 에서 쿠키들 추출
    if(cookies != null){                                      // null 이 아닐경우
      for(int i = 0 ; i < cookies.length ; i++){              // 반복 시작
        cookieMap.put(cookies[i].getName(), cookies[i]);      // 쿠키 이름을 KEY로 지정하고 쿠키를 VALUE로 지정
      }
    }
  } 
  
  public Cookie getCookie(String name){                       // 쿠키 이름일 입력하면 
    return cookieMap.get(name);                               // 해당하는 쿠키를 리턴
  }
  
  public String getValue(String name) throws IOException {    // 쿠키 이름 입력하면 값 출력, IOException 처리를 해야하기도 한다.
    Cookie cookie = cookieMap.get(name);                      // 쿠키 이름을 통해 해당 쿠키를 얻고
    if(cookie == null){                                       // 없을 경우
      return null;                                            // null 반환  
    }
    return URLDecoder.decode("cookie.getValue()", "euc-kr");  // 있을 경우 decode 해서 해당 쿠키에서 값 추출하고 그것을 리턴  
  }
  
  public boolean exists(String name){
    return cookieMap(name) !=  null;                          // 쿠키가 존재하는지 판단 후 true/false 반환
  }
  
  public static Cookie createCookie(String name, String value) throws IOException {
    return new Cookie(name, URLEncoder.encode(value, "utf-8"));
  } // 일반 적인 쿠키 생성
  
  public static Cookie createCookie(String name, String value, String path, int maxAge) throws IOException {
    Cookie cookie new Cookie(name, URLEncoder.encode(value, "utf-8"));
    cookie.setPath(path);
    cookie.setMaxAge(maxAge);
    return cookie;
  } // 오버로딩을 이용한 쿠키 생성, 패스와 유효기간도 지정 가능 

  public static Cookie createCookie(String name, String value, String domain, String path, int maxAge) throws IOException {
    Cookie cookie new Cookie(name, URLEncoder.encode(value, "utf-8"));
    cookie.setDomain(domain);
    cookie.setPath(path);
    cookie.setMaxAge(maxAge);
    return cookie;
  } // 오버로딩을 이용한 쿠키 생성2, 패스와 유효기간 및 도메인도 설정 가능
  
}
```
이렇게 생성한 ```Cookies 클래스```를 사용하려면 먼저 ```Cookies.java```를 컴파일 해서 ```Cookies.class```를 생성해야 한다.    
  
1. javac 명령어를 실행하기 위해 PATH 환경 변수에 JDK의 bin 폴더를 추가한다.  
C:\> set PATH=c:\java\jdk1.8.0_45\bin;%PATH%    

2. 컴파일 하는데 필요한 jar 파일을 클래스패스에 추가한다.   
C:\> set CLASSPATH=c:\apache-tomcat-8.0.21\lib\servlet-api.jar        

3. chap09 웹 어플리케이션 폴더의 WEB-INF 폴더로 이동한다.   
C:\> cd apache-tomcat-8.0.21\webapps\chap09\WEB-INF        

4. WEB-INF 폴더에 calsses 하위 폴더를 생성한다.    
C:\...\WEB-INF> mkdir classes  

5. javac 명령어를 이용해서 Cookis.java 파일을 컴파일 한다.         
C:\...\WEB-INF> javac -d classes src\util\Cookies.java    
     
```Cookies 클래스```가 사용하는 ```Cookie 클래스```는 서블릿 API에 포함되어 있으므로   
톰캣의 ```servlet-aoi.jar``` 파일을 클래스패스에 추가했다.    
    
```javac``` 명령어까지 실행하면 ```WEB-INF\classes\util``` 폴더에 ```Cookies.class``` 파일이 생성 되었을 것이다.    
```Cookies 클래스``` 파일을 생성했다면, ```Cookies 클래스```를 사용해서 쿠키 처리 코드를 간단하게 작성할 수 있다.   
  
## 2.1. Cookies 클래스를 이용한 쿠키 생성
**Cookies 클래스를 미사용 경우**
```
Cookie cookie = new Cookie("id", URLEncoder.encode(value, "utf-8"));
cookie.setDomain(".madvirus.net");
cookie.setPath("/");
cookie.setMaxAge(60);
```
**Cookies 클래스 사용 경우**
```
Coookie cookie1 = Cookies.createCookie("name", "김우재");
Coookie cookie1 = Cookies.createCookie("name2", "김우재", "/path1", -1);
Coookie cookie1 = Cookies.createCookie("id", "jsp", ".madvirus.net", "/path1", 60);
```
코드가 훨씬 간결해지고 여러개의 쿠키들도 만들기 더욱 쉽다.  

**생성 예제**
```
<%@ page contentType = "text/html; charset=utf-8" %>
<%@ page import = "util.Cookies" %>
<%
  response.addCookie(Cookies.createCookie("name", "김우재"));
  response.addCookie(
    Cookies.createCookie("id", "kwj1270", "/chap09", -1));  
%>
<html>
<head><title>Cookies 사용 예</title></head>
<body>

Cookies를 사용하여 쿠키 생성

</body>
</html>
```
위 코드처럼 ```respons.addCookie()```메서드를 사용시에도 간결해진 코드로 한번에 작성 가능하다.   
  
## 2.2. Cookies 클래스를 이용한 쿠키 읽기
웹 브라우저가 전송한 쿠키를 읽으려면 ```Cookies 객체```를 생성한 후  
```getCookie()```, ```getValue()```, ```exists()```등의 메서드를 사용하면 된다.  
```
Cookies cookies = new Cookies(request); // request 기본 개체로부터 쿠키 정보를 읽어온다.(Map)

if(cookies.exitsts("name")){
  Cookie cookie = cookies.getCookie("name")
  ...
}

if(cookies.exists("id")){
  String value = cookies.getValue("id");
  ...
}
```
  
**조회 예제**
```
<%@ page contentType = "text/html; charset=utf-8" %>
<%@ page import = "util.Cookies" %>
<%
  Cookies cookies = new Cookies(request);
%>
<html>
<head><title>Cookie 사용 </title></head>
<body>

name 쿠키 = <%= cookise.getValue("name") %><br>
<% if(cookies.exists("id")){ %>
id 쿠키 = <%= cookise.getValue("id") %><br>
<% } %>

</body>
</html>
```




***
# 3. 대주제
> 인용
## 2.1. 소 주제
### 2.1.1. 내용1
```
내용1
```   

***
# 3. 대주제
> 인용
## 3.1. 소 주제
### 3.1.1. 내용1
```
내용1
```
