클라이언트와의 대화 2 : 세션
=======================
세션을 사용하면 클라이언트의 상태를 저장할 수 있다.    
세션과 쿠키와의 차이점은 세션은 웹 브라우저가 아닌 웹 서버에 값을 저장한다는 점이다.     
         
서버는 세션을 사용해서 클라이언트의 상태를 유지할 수 있기 때문에,       
로그인한 사용자 정보를 유지하기 위한 목적으로 세션을 사용한다.      
  
# 1. 세션 사용하기: session 기본 객체
쿠키는 웹 브라우저와 웹 서버 양쪽에서 생성 가능하지만 (JSP에서는 서버에서 생성)     
세션은 오직 서버에만 생성된다.         
즉 세션은 서버에서 생성하고 서버에서 값을 저장한다는 점이다.              
         
웹 컨테이너는 기본적으로 한 웹 브라우저마다 한 세션을 생성한다.        
즉, 같은 JSP 페이지라도 웹 브라우저에 따라 서로 다른 세션을 사용한다.        
     
웹 브라우저마다 세션이 따로 존재하기 때문에, 세션은 웹 브라우저와 관련된 정보를 저장하기에 알맞은 장소이다.               
쿠키는 반대로 유효시간이 지나지 않았다면 웹 브라우저를 종료했다가 다시 접속해보면 데이터가 존재한다.          
(이는 쿠키 데이터는 웹 브라우저에 통용되어 사용된다는 것을 알 수 있다.)           
    
즉, 쿠키가 클라이언트 측의 데이터 보관소라면 세션은 서버측의 데이터 보관소인 것이다.    
   
## 1.1. 세션 생성하기
JSP에서 세션을 생성하려면 ```page 디렉티브```의 ```session 속성```을 ```"true"```로 지정하면 된다.  
```
<%@ page contentType="text/html; charset=utf-8" %>
<%@ page session = "true" %>
<%
  ...
  session.setAttribute("userInfo",userInfo);
  ...
%>
```
그런데 ```page 디렉티브```의 ```session 속성```은 기본값이 ```true``` 이므로 ```false```를 지정하지 않으면 기술하지 않아도 된다.  
   
```session``` 은 또한 ```page```, ```request```, ```application``` 과 같이 영역을 가지는 기본 객체중 하나 이므로     
```속성(Attribute)```을 사용할 수 있고 한 사용자와 관련된 정보를 JSP 사이에 공유하기 위해 사용한다.        
그렇기에 영역은 '하나의 웹 브라우저에 대해 처리하는 JSP 파일들' 이라고 보면 될 것 같다.        
따라서 세션이 생성되면 ```session``` 기본 객체를 통해서 세션을 사용할 수 있다.    
       
## 1.2. session 기본 객체
우선 ```session```은 기본 객체이므로 앞서 말한 속성에 관련된 메서드를 사용할 수 있다.  
이뿐만이 아니라 ```session```만의 고유한 정보를 제공하며, 이들 정보를 구할 때 사용되는 메서드도 있다.  
```
getId()               | String | 세션의 고유 ID를 구한다.
getCreationTime()     | long   | 세션이 생성된 시간을 구한다. 1970/1/1 이후 흘러간 밀리 세컨드를 의미한다.   
getLastAccessedTime() | long   | 웹 브라우저가 가장 마지막에 세션에 접근할 시간을 구한다. 1970/1/1 이후 흘러간 밀리 세컨드를 의미한다.   
```
웹 서버는 웹 브라우저마다 별도의 세션을 갖는다.  
이때 각 세션을 구분하기 위해서 각 세션마다 고유 ID를 할당하는데 그 ID를 **세션 ID**라고 한다.   
  
웹 서버는 웹 브러우저에 ```세션 ID```를 전송한다.  
웹 브라우저는 웹 서버에 연결할 때마다 매번 ```세션 ID```를 보내서 웹 서버가 어떤 세션을 사용할지 판단할 수 있게 해준다.  
   
이렇듯 웹 브라우저와 웹 서버는 서로 세션을 공유하는데 이 때 사용되는 것이 **쿠키**이다.    
쿠키 목록중에 ```JSESSIONID 쿠키```가 ```세션 ID```를 공유할 때 사용하는 쿠키이다.     
즉, 쿠키의 ```JSESSIONID 쿠키```를 통해서 웹 서버는 어떤 세션을 사용할지를 판단하는 것이다.   
그렇기에 우리가 정의하지 않아도 세션이 생성되면 자동으로 ```JSESSIONID 쿠키```가 생성되는 것이다.  
     
**세션 사용 예시**
```
<%@ page contentType="text/html; charset=utf-8" %>
<%@ page session = "true" %>
<%@ page import = "java.util.Date" %>
<%@ page import = "java.text.SimpleDateFormat" %>
<%
  Date time = new Date();
  SimpleDateFormat formmater = new SimpliDateFormat("yyyy-MM-dd HH:mm:ss");
%>
<html>
<head><title>세션 정보</title></head>
<body>
세션 ID: <%= session.getId() %> <br>
<%
  time.setTime(session.getCreationTime());
%>
세션 생성 시간: <%= formatter.format(time) %>
<%
  time.setTime(session.getLastAccessedTime());
%>
최근 접근 시간: <%= formatter.format(time) %>

</body>
</html>
```
```세션 ID``` 는 웹 브라우저를 종료하고 다시 켰을 때마다 새로운 값을 가질 것이다.     
세션 생성 시간은 웹 브라우저가 처음으로 해당 JSP를 접속했을 때 세션이 생성되는 시간을 의미한다.  
하지만 ID 와 마찬가지로 종료하고 다시 켰을 때마다 새로운 값을 가질 것이다.  
최근 접근 시간을 확인하는 방법은 하나의 웹 브라우저에서 해당 JSP를 여러번 접속하면 된다.     
   
## 1.3. 기본 객체의 속성 사용
한 번 생성된 세션은 지정한 유효 시간 동안 유지된다. (단, 웹 브라우저 종료시 사라짐)    
따라서, 웹 어플리케이션을 실행하는 동안 지속적으로 사용해야 하는 데이터의 저장소로 세션이 적당하다.  
  
```session``` 기본 객체는 하나의 웹 브라우저의 여러 요청을 처리하는 JSP 페이지 사이에서 공유된다.    
따라서, 로그인한 회원 정보 등 웹 브라우저와 일대일로 관련된 값을 저장할 때에는 쿠키 대신 세션을 사용할 수 있다.
   
**세션과 속성 메서드 예시**
```
<%@ page contentType="text/html; charset=utf-8" %>
<%
  session.setAttribute("MEMBERID", "kwj1270");
  session.setAttribute("NAME", "김우재");
%>
<html>
<head><title>세션에 정보 저장</title></head>
<body>

세션에 정보를 저장했습니다.  

</body>
</html>
```
```
<%
  String name = (String)session.getAttribute("NAME");
%>
회원명: <%= name %>
```
이로써 하나의 웹 브라우저에 대해 처리하는 모든 JSP 파일들은 ```session```을 통해 속성을 사용할 수 있다.
즉, 세션이 종료되기 전까지 속성값을 사용할 수 있다.

### 1.3.1. 세션 VS 쿠키 

로그인한 회원 정보 등 웹 브라우저와 일대일로 관련된 값을 저장할 때에는 쿠키 대신 세션을 사용할 수 있다고 했다.  

쿠키도 로그인한 상태를 나타내는 쿠키가 존재하면 로그인 했다고 인식한다.    
단, 쿠키는 유효시간이 끝나기 전까지 여러 웹 브라우저에서 공통으로 사용한다는 차이점이 있다.    
   
즉, 한개의 웹 브라우저에서 로그인을 하고 종료 후 다시 새로운 웹 브라우저를 하나 띄었다고 가정시      
세션은 다시 새롭게 로그인을 해야하고, 쿠키는 로그인이 된 상태로 나온다.  
세션을 사용할 경우 창 종료시에도 다시 로그인 해야한다는 불편함이 있겠지만 사실 쿠키보다 세션을 더 많이 이용한다.
   
```
궁금한점 : 세션과 쿠키를 같이 사용하면 안되나?
생각한 것이 세션을 통해 로그인이 되면 쿠키를 생성한다.  
쿠키는 유효시간이 존재하니 브라우저 종료후 재접속 하더라도 기존 로그인 상태 남아있는다. 
```
     
쿠키 대신에 세션을 사용하는 가장 큰 이유는 쿠키보다 보안에 앞선다는 점이다.    
쿠키의 이름이나 데이터는 네트워크를 통해 전달되기 때문에    
HTTP 프로토콜을 사용하는 경우 중간에 누군가 쿠키의 값을 읽어올 수 있다.    
하지만 세션의 값은 오직 서버에만 저장되기 때문에 중요한 데이터를 저장하기에 알맞은 저장소이다.  
  
두번째 이유는 쿠키는 웹 브라우저의 설정에 따라 좌우 되지만     
세션은 웹 브라우저의 설정이 무엇이든간에 웹 서버에 존재하여 영향을 받지 않는다.       
단 쿠키를 사용하지 못하는 경우 ```세션 ID``` 공유하는 측면에서 문제가 생길 수는 있지만   
서블릿/JSP는 쿠키를 사용할 수 없는 경우,  
URL 재작성 방식을 사용해서 ```세션 ID```를 웹 브라우저와 웹 서버가 공유할 수 있다.    
   
그리고 물론 세션에도 단점이 존재한다.  
세션은 여러 서버에서 공유할 수 없다.  
반면에 쿠키는 도메인을 이용해서 쿠키를 여러 도메인 주소에 공유할 수 있다.  
이런 이유로 Daum과 같은 포털 사이트는 쿠키를 이용해서 로그인 정보를 저장한다.  
     
## 1.4. 세션 종료
세션을 유지할 필요가 없으면 ```session.invalidate()``` 메소드를 사용해서 세션을 종료한다.  
세션이 종료되면 ```session``` 기본 객체를 삭제하고 ```session``` 관련 속성 목록도 삭제한다.    
   
**세션 종료 예시**
```
<%@ page contentType="text/html; charset=utf-8" %>
<%
  session.invaliddate();
%>
<html>
<head><title>세션 종료</title></head>
<body>
  
  세션을 종료하였습니다.
  
</body>
</html>
```
위 코드로 세션을 종료시키고 다시 세션을 생성하는 JSP 파일에 접근하면  
기존과 다른 ```세션 ID```를 가지는 세션이 다시 생성된다.    

## 1.5. 세션 유효 시간
세션은 최근 접근 시간을 갖는다.  
```session``` 기본 객체를 사용할 때마다 세션의 최근 접근 시간은 갱신된다.  
```
session.getLastAccessedtime();
```

***
# 2. 대주제
> 인용
## 2.1. 소 주제
### 2.1.1. 내용1
```
내용1
```   

***
# 3. 대주제
> 인용
## 3.1. 소 주제
### 3.1.1. 내용1
```
내용1
```
