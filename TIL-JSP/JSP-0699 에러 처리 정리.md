에러 처리
=======================
# 1.
자바에서는 ```Try...catch```로 에러를 처리한다.  
이를 JSP 에서 그대로 사용한다고 보면 된다.   
```
<%@ page contentType="text.html; charset=utf-8" %>
<html>
<head><title>파라미터 출력</title></head>
<body>

name 파라미터 값:
<% try{ %>
<%=request.getParameter("name").toUpperCase(); %>
<% } catch(Exception ex){ %>
name 파라미터가 옳지 않습니다.
<% } %>
</body>
</html>
```

# 2.
JSP는 실행 도중 익셉션이 발생할 때 지정한 JSP 페이지를 보여줄 수 잇는 기능을 제공하고 있다.    
```
<%@ page errorPage="경로" %>
```
```
<%@ page contentType="text/html; charset=utf-8" %>
<%@ page errorPage="/error/viewErrorMessage.jsp" %>
<html>
<head><title>파라미터 출력</title></head>
<body>

  name 파라미터 값 : <%= request.getParameter("name").toUpperCase() %>

</body>
</html>
```
에러가 발생하면 자동으로 지정한 에러페이지를 출력한다.   
  
# 3. 
에러 페이지를 작성할 때  
에러 페이지를 지정하려면 혹은 알리려면 ```page 디렉티브```의 ```isErrorPage 속성```의 값을 ```true``` 로 주어야한다. 
```
<%@ page isErrorPage="true" %>
```
```
<%@ page contentType="text/html; charset=utf-8" %>
<%@ page isErrorPage="true" %>
<html>
<head><title>에러 발생</title></head>
<body>

요청 처리 과정에서 에러가 발생하였습니다. <br>
빠른 시간 내에 문제를 해결하도록 하겠습니다. 
<p>
에러 타입: <%= exception.getClass().getName() %> <br>
에러 메시지: <b><%= exception.getMessage() %> </b>
</body>
</html>
```
하지만 웹 브라우저마다 에러 페이지를 출력하는 기준이 있는데,   
인터넷 익스플로러는    
   
* 응답의 상태 코드가 400, 404나 500등 에러코드이고,  
* 전체 응답 결과 데이터의 길이가 512바이트 보다 작을 대    
  
위와 같은 경우에는 서버에서 전송한 응답 화면이 아닌 자체적으로 제공하는 오류 메시지 화면을 출력한다.     
  
그렇기에 ```512바이트```를 넘겨주도록 JSP 페이지를 작성해 주어야 하는데 방법은 간단하다.  
화면에 표시하고 싶지 않게 크기를 늘리려면 **주석** 을 이용하면 된다.  
```
<%@ page contentType="text/html; charset=utf-8" %>
<%@ page isErrorPage="true" %>
<html>
<head><title>에러 발생</title></head>
<body>

요청 처리 과정에서 에러가 발생하였습니다. <br>
빠른 시간 내에 문제를 해결하도록 하겠습니다. 
<p>
에러 타입: <%= exception.getClass().getName() %> <br>
에러 메시지: <b><%= exception.getMessage() %> </b>
<!-- 
만약 에러 페이지의 길이가 512바이트보다 작다면,
인터넷 익스플로러는 이 페이지가 출력하는 에러 페이지를 출력하지 않고 
자체적으로 제공하는 'HTTP 오류 메시지' 화면을 출력한다.
인터넷 익스플로러에서도 에러 페이지 내용을 올바르게 출력하려면
응답 결과에 이 주석과 같은 내용을 포함해서
에러 데이터가 512바이트를 넘도록 해야 한다.  
-->
</body>
</html>
```
이제 다시 에러를 발생시켜보고 확인해보면  
```512바이트```가 넘으니 현재 다시 작성한 에러페이지가 출력 될 것이다.    
   
# 4.
JSP/서블릿은 에러 코드별로 사용할 에러페이지를 ```web.xml``` 파일에 지정할 수 있다.  
```
<web-app ...>
...

<error-page>
  <error-code>에러코드</error-code>
  <location>에러페이지의 URI</location>
</error-page>

...
</web-app ...>
``` 
  
```<error-page> 태그```는 한 개의 에러 페이지를 지정한다.    
```<error-code> 태그```는 특정 에러 상태 코드를 지정한다.  
```<location> 태그```는 에러 페이지로 사용할 JSP 파일의 경로를 지정한다.   
  
**주요 응답 상태 코드**  
```
HTTP 프로토콜은 응답 상태 코드를 이용해서 서버의 처리 결과를 웹 브라우저에게 알려준다.  

200 : 요청을 정상적으로 처리함
307 : 임시로 페이지를 리다이렉트함
400 : 클라이언트의 요청이 잘못된 구문으로 구성됨
401 : 접근을 허용하지 않음
404 : 요청한 URL을 처리하기 위한 자원이 존재하지 않음
405 : 요청한 메서드(GET/POST/HEAD 등의 전송 방식)를 허용하지 않음
500 : 서버 내부 에러가 발생함(예를 들어, JSP에서 익셉션이 발생함)
503 : 서버가 일시적으로 서비스를 제공할 수 없음(급격하게 부하가 몰리거나 서버가 임시 보수 중인 경우가 해당)

JSP가 정상적으로 실행되는 경우 응답 코드로 200이 전송되며, 
response.sendRedirect()를 이용할 경우 응답 코드로 307을 전송한다.
```

# 5.
JSP 페이지에서 발생하는 익셉션 종류별로 에러 페이지를 지정할 수도 있다.  
```
<web-app ...>
...

<error-page>
  <exception-type>익셉션클래스</exception-type>
  <location>에러페이지의 URI</location>
</error-page>

...
</web-app ...>
``` 
  
# 6.
에러 페이지를 여러 방법으로 지정한 경우 우선순위에 따라 사용할 에러 페이지를 선택한다.  

**우선순위**  
1. page 디렉티브의 errorPage 속성에 지정한 에러 페이지를 보여준다.  
2. JSP 페이지에서 발생한 익셉션 타입에 맞는 web.xml에 지정한 에러 페이지를 보여준다.  
3. 에러코드가 맞는 web.xml에 지정한 에러 페이지를 보여준다.
4. 아무것도 해당하지 않는 경우 웹 컨테이너가 제공하는 기본 에러 페이지를 보여준다.  
  
그래서 우선순위를 고려해서 에러페이지를 지정한다.  
  
**지정 순서**   
* 전용 에러 페이지가 필요한 경우 page 디렉티브의 errorPage 속성을 사용해서 에러 페이지를 지정한다.  
* 범용적인 에러 코드에 대해 web.xml에 에러 페이지를 지정한다.  
* 별도로 처리해야 하는 익셉션 타입에 대해서는 web.xml에 태그를 추가해서 에러 페이지를 지정한다.    
  
# 7. 
처음 버퍼를 플러시 할 때 응답 헤더를 전송한다고 했다.  
하지만 사실상 응답 상태 코드가 응답 헤더 앞에 전송되므로 **최초로 전송되는 것은 응답 상태 코드**이다.  
  
이런 이유로 **버퍼가 플러시 된 이후에 에러가 발생하면**    
웹 브라우저에 이미 ```200 응답 상태 코드```와 일부 응답 결과 화면이 전송되기 때문에,      
일부 페이지의 내용이 웹 브라우저에 출력되고 그 뒤에 에러 페이지의 내용이 붙게된다.          
또한 ```200 응답 상태 코드```를 전송했기 때문에 웹 브라우저는 정상적으로 응답이 도착했다고 판단한다.    
  
따라서 익셉션이 발생하기 전에 버퍼가 플러시 될 가능성이 있다면     
버퍼 크기를 늘려서 에러가 발생하기 전에 버퍼가 플러시 되지 않도록 해야한다.     
